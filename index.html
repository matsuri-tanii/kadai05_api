<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>水分補給アプリ</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <header>
    <h1>水分補給アプリ</h1>
  </header>

  <main>
    <div class="container">
      <h2>水分補給の記録</h2>
      <form id="water-form">
        <label for="amount">水分量 (ml):</label>
        <input type="number" id="amount" name="amount" required>
        <button type="submit">記録する</button>
      </form>

      <div id="log">
        <h3>記録一覧</h3>
        <ul id="water-log-list"></ul>
      </div>
    </div>
    <div class="container">
      <h2>水分補給の目標</h2>
      <form id="goal-form">
        <label for="goal">目標水分量 (ml):</label>
        <input type="number" id="goal" name="goal" required>
        <button type="submit">設定する</button>
      </form>

      <div id="goal-display">
        <h3>現在の目標: <span id="current-goal">未設定</span> ml</h3>
      </div>
      <div id="goal-log">
        <h3>目標達成状況</h3>
        <p id="goal-status">目標未達成</p>
      </div>
      <div id="goal-progress">
        <h3>進捗状況</h3>
        <p id="progress">0 ml / <span id="goal-amount">未設定</span> ml</p>
      </div>
    </div>
    <div class="container">
      <h2>水分補給のヒント</h2>
      <ul>
        <li>定期的に水分を摂ることを心がけましょう。</li>
        <li>運動後や暑い日は特に意識して水分補給を行いましょう。</li>
        <li>水分補給の目標を設定し、達成感を感じましょう。</li>
      </ul>
    </div>
    
  </main>

  <footer>
    <small>水分補給の会</small>
  </footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- axiosライブラリの読み込み -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script>
    天気API連携: 今日の気温や湿度に応じて、推奨される水分摂取量を調整できます。例えば、暑い日や湿度が高い日は多めに、涼しい日は少なめにといった具合です。

    // リクエストを送るurlを準備
    // 位置情報を取得して天気情報を表示する
    if (!navigator.geolocation) {
      alert("このブラウザは位置情報を取得できません");
    } else {
      console.log("位置情報を取得します");
    }
    // 位置情報を取得する成功時のコールバック関数
    function getPositionSuccess(position){
      console.log(position.coords.latitude);
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      $("#latitude").text(lat);
      $("#longitude").text(lng);
      
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=ad7685d96234d5a3d777e72fd881dbf2&units=metric`;

      axios
      .get(url)
      .then(function (response) {
        console.log(response.data);
        $("#weather").text(response.data.weather[0].main);
        $("#temperature").text(response.data.main.temp + "℃");
        $("#humidity").text(response.data.main.humidity + "%");
        $("#pressure").text(response.data.main.pressure + "hPa");
      })

      .catch(function (error) {
        console.log(error);
      })
    }

    function getPositionError(error){
      const errorMassages = [
        "位置情報が許可されてません",
        "現在位置を特定できません",
        "位置情報を取得する前にタイムアウトになりました",
      ];
      alert("error: " + errorMassages[error.code - 1]);
    }

    navigator.geolocation.getCurrentPosition(getPositionSuccess, getPositionError);

        $(document).ready(function () {
      let waterLog = [];
      let goalAmount = 0;
      let totalWaterIntake = 0;

      // 水分補給の記録
      $('#water-form').on('submit', function (e) {
        e.preventDefault();
        const amount = parseInt($('#amount').val());
        if (isNaN(amount) || amount <= 0) {
          alert('正しい水分量を入力してください。');
          return;
        }
        waterLog.push(amount);
        totalWaterIntake += amount;
        $('#water-log-list').append(`<li>${amount} ml</li>`);
        $('#amount').val('');
        updateProgress();
      });

      // 水分補給の目標設定
      $('#goal-form').on('submit', function (e) {
        e.preventDefault();
        goalAmount = parseInt($('#goal').val());
        if (isNaN(goalAmount) || goalAmount <= 0) {
          alert('正しい目標水分量を入力してください。');
          return;
        }
        $('#current-goal').text(goalAmount);
        $('#goal-amount').text(goalAmount);
        $('#goal-status').text(totalWaterIntake >= goalAmount ? '目標達成' : '目標未達成');
        updateProgress();
      });

      // 進捗状況の更新
      function updateProgress() {
        $('#progress').text(`${totalWaterIntake} ml / ${goalAmount} ml`);
      }
    }); 

  </script>


</body>

</html>
